<?xml version="1.0"?>
<!--
	Pick with an onAlarm set.  Expected behavior: 'onMessage' should occur
	before 'onAlarm'.
-->
<process name="pick4_onMessageWithAlarm-2.0" 
    targetNamespace="http://pxe/bpel/unit-test" 
    xmlns:bpws="http://schemas.xmlsoap.org/ws/2004/03/business-process/"
    xmlns="http://schemas.xmlsoap.org/ws/2004/03/business-process/"
    xmlns:tns="http://pxe/bpel/unit-test"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:test="http://pxe/bpel/unit-test.wsdl" 
    suppressJoinFailure="yes">
  
  <import namespace="http://pxe/bpel/unit-test.wsdl"
	  importType="http://schemas.xmlsoap.org/wsdl/"
	  location="Pick4-2.0.wsdl" />

   <partnerLinks>
     <partnerLink name="testPartnerLink" 
		  partnerLinkType="test:TestPartnerLinkType" 
		  myRole="me" />
  </partnerLinks>
  
  <variables>
    <variable name="var1" messageType="test:PickMessage"/>
  </variables>
  
  <correlationSets>
    <correlationSet name="PickCorrelator" properties="test:Id"/>
  </correlationSets>
  
  <sequence>   
    <receive name="startReceive"
	     partnerLink="testPartnerLink"
	     portType="test:TestPortType"
	     operation="pickOp1"
	     variable="var1"
	     createInstance="yes" >
      <correlations>
		<correlation set="PickCorrelator" initiate="yes" />
      </correlations>
    </receive>
    <wait>
      <for>'PT4S'</for>
    </wait>
    <pick name="pick1" createInstance="no">
      <onMessage partnerLink="testPartnerLink"
		 portType="test:TestPortType"
		 operation="pickOp2"
		 variable="var1">
	<correlations>
	  <correlation set="PickCorrelator" initiate="no" />
	</correlations>
	<assign>
	  <copy>
	    <from>'onMessage'</from>
	    <to>$var1/DataPart</to>
	  </copy>
	</assign>  	  
      </onMessage>
      <onAlarm>
	<for>'P0Y0M0DT0H0M10S'</for>
	<assign>
	  <copy>
	    <from>'onAlarm'</from>
	    <to>$var1/DataPart</to>
	  </copy>
	</assign>
      </onAlarm>
    </pick>
    <reply name="endReply" 
	   operation="pickOp1" 
	   partnerLink="testPartnerLink"
	   portType="test:TestPortType" 
	   variable="var1"/>
  </sequence>
</process>
